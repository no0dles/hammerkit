envs:
  NODE_VERSION: 14.16.0

tasks:
  build:
    description: build typescript
    deps: [npm:install]
    image: node:$NODE_VERSION
    src:
      - src
      - tsconfig.json
    generates:
      - dist
    cmds:
      - node_modules/.bin/tsc

  format:
    description: lint fix and prettier
    image: node:$NODE_VERSION
    deps: [npm:install]
    cmds:
      - node_modules/.bin/prettier -w src/** tests/**
      - node_modules/.bin/eslint . --ext .ts --fix
    src:
      - src
      - tests
      - .eslintignore
      - .eslintrc
      - .prettierrc

  lint:
    description: lint source code
    image: node:$NODE_VERSION
    deps: [npm:install]
    src:
      - src
      - tests
      - .eslintignore
      - .eslintrc
    cmds:
      - node_modules/.bin/eslint . --ext .ts

  prettier:
    description: format source code
    image: node:$NODE_VERSION
    deps: [npm:install]
    src:
      - src
      - tests
      - .prettierrc
    cmds:
      - node_modules/.bin/prettier -w src/** tests/**

  test:
    description: test code
    deps: [npm:install]
    src:
      - src
      - tests
      - jest.config.ts
      - tsconfig.test.json
      - tsconfig.json
      - examples
    generates:
      - coverage
    cmds:
      - node_modules/.bin/jest --coverage

includes:
  npm: ./build.npm.yaml
